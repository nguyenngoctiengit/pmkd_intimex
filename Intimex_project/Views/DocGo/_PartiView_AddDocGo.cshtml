@model Data.Models.Trading_system.Document
<style>
    .custom-file-upload {
        border: 1px solid #161515;
        display: inline-block;
        padding: 6px 12px;
        cursor: pointer;
        color: black;
    }
</style>
<form method="post" asp-action="add_docgo" asp-controller="DocGo" enctype="multipart/form-data">
    <div class="modal-body">
        <div class="form-group row">
            <div class="form-group col-md-4">
                <label class="col-form-label col-md-4 col-sm-4">Độ khẩn</label>
            </div>
            <div class="form-group col-md-4">
                <label class="col-form-label col-md-4 col-sm-4">Loại văn bản</label>
            </div>
            <label class="col-form-label col-md-1 col-sm-1">Số/Ký hiệu</label>
            <div class="col-md-3 col-sm-3">
                @(Html.DevExtreme().TextBoxFor(m => m.NumberSign))
            </div>
        </div>
        <div class="form-group row">
            <div class="form-group col-md-4">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="0" checked>
                    <label class="form-check-label" for="inlineRadio1">Văn bản thường</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="1">
                    <label class="form-check-label" for="inlineRadio2">Văn bản khẩn</label>
                </div>
            </div>
            <div class="form-group col-md-4">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="2" id="DocPlace2" checked onclick="openDocPlace()">
                    <label class="form-check-label" for="inlineRadio1">Gửi nội bộ</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="1" id="DocPlace1" onclick="openDocPlace()">
                    <label class="form-check-label" for="inlineRadio2">Gửi ra ngoài</label>
                </div>
            </div>
            <label class="col-form-label col-md-1 col-sm-1">Ngày phát hành</label>
            <div class="col-md-3 col-sm-3">
                @(Html.DevExtreme().DateBoxFor(m => m.DocDate))
            </div>
        </div>
        <div class="form-group row">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-1 col-sm-1">Hình thức</label>
                <div class="col-md-3 col-sm-3">
                    @(Html.DevExtreme().SelectBoxFor(m => m.DocTypeId).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .Controller("lookup")
                                                                                                .LoadAction("getDoctype")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("DocTypeId"))
                                                                                            .DisplayExpr("TypeName")
                                                                                            .ValueExpr("DocTypeId")
                                                                                            .SearchEnabled(true))
                </div>
                <label class="col-form-label col-md-1 col-sm-1">Số tờ</label>
                <div class="col-md-1 col-sm-1">
                    @Html.DevExtreme().TextBoxFor(m => m.NumberOfPage)
                </div>
                <label class="col-form-label col-md-1 col-sm-1">Người kí</label>
                <div class="col-md-5 col-sm-5">
                    @(Html.DevExtreme().SelectBoxFor(m => m.Singer).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .Controller("lookup")
                                                                                                .LoadAction("getSigner")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("UserName1"))
                                                                                            .DisplayExpr("FullName1")
                                                                                            .ValueExpr("FullName1")
                                                                                            .SearchEnabled(true))
                </div>
            </div>
        </div>
        <div class="form-group row" id="DocPlace" style="display:none">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-1 col-sm-1">Nơi gửi</label>
                <div class="col-md-11 col-sm-11">
                    @(Html.DevExtreme().SelectBoxFor(m => m.DocPlaceId).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .LoadAction("getDocplace")
                                                                                                .Controller("lookup")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("DocPlaceId"))
                                                                                            .DisplayExpr("DocPlaceName")
                                                                                            .ValueExpr("DocPlaceId")
                                                                                            .SearchEnabled(true))
                </div>
            </div>
        </div>
        <div class="form-group row">
            <div class="form-group col-md-12">
                <div class="col-md-1 col-sm-1">
                    <label class="custom-file-upload">
                        <input type="file" id="fileUpload" onchange="uploadMultipleFile(event)" name="files" multiple hidden />
                        <i class="fa fa-cloud-upload"></i>
                    </label>
                </div>
                <div class="col-md-1 col-sm-1">
                    @*@Html.DevExtreme().Button().Icon("fa fa-print")*@
                </div>
                <div class="col-md-10 col-sm-10">
                    <table class="table" id="ListofFiles">
                        <tr>
                            <th>
                                Files
                            </th>
                            <th>
                                Action
                            </th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:0px">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-12 col-sm-12">Tên và loại trích yếu văn bản</label>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-12 col-sm-12">
                @(Html.DevExtreme().TextAreaFor(m => m.Contents))
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:0px">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-12 col-sm-12">Ghi chú</label>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-12 col-sm-12">
                @(Html.DevExtreme().TextBoxFor(m => m.Note))
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="submit" asp-action="add_docgo" asp-controller="DocGo" class="btn btn-primary">Save</button>
    </div>
</form>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">

    function openDocPlace() {
        if (document.getElementById('DocPlace1').checked) {
            document.getElementById('DocPlace').style.display = 'block';
        } else {
            document.getElementById('DocPlace').style.display = 'none';
        }
    }
    /* event submit form upload*/
    function uploadMultipleFile(e) {

        var files = e.target.files;
        var formData = new FormData();
        for (var i = 0; i < files.length; i++) {
            formData.append("files", files[i]);
            var extensionFile = files[i].name;
            var markup = "<tr><td><a data-toggle='modal' data-target='#exampleModal' data-imageid=" + extensionFile + ">" + extensionFile + "</a></td><td><a href='#' onclick='DeleteFile(this,\"" + extensionFile + "\")'><span class='glyphicon glyphicon-remove red'></span></a></td></tr>";
            $("#ListofFiles tbody").append(markup);
        }
        axios.post("/DocGo/upLoadFiles", formData);
    }

    $('#exampleModal').on('show.bs.modal', function (event) {
        let bookId = $(event.relatedTarget).data('imageid');
        $(this).find('.modal-body input').val(bookId);
        document.getElementById('myImg').src = "/FileUploads/Document/" + bookId;
    })

    function DeleteFile(r, extensionFile) {
        var i = r.parentNode.parentNode.rowIndex;
        document.getElementById('ListofFiles').deleteRow(i);
        try {
            $.post("/DocCome/DeleteFile", $.param({ extensionFile: extensionFile }, true));
        }
        catch {
            $.notify("something wrong", "error");
        }
    }
</script>

