@model Data.Models.Trading_system.Document
<style>
    .custom-file-upload {
        border: 1px solid #161515;
        display: inline-block;
        padding: 6px 12px;
        cursor: pointer;
        color: black;
    }
</style>
<form method="post" asp-action="Edit_DocGo" asp-controller="DocGo" asp-route-id="@ViewBag.DocId" enctype="multipart/form-data">
    <div class="modal-body">
        <div class="form-group row">
            <div class="form-group col-md-4">
                <label class="col-form-label col-md-4 col-sm-4">Độ khẩn</label>
            </div>
            <div class="form-group col-md-4">
                <label class="col-form-label col-md-4 col-sm-4">Loại văn bản</label>
            </div>
            <label class="col-form-label col-md-1 col-sm-1">Số/Ký hiệu</label>
            <div class="col-md-3 col-sm-3">
                @(Html.DevExtreme().TextBoxFor(m => m.NumberSign))
            </div>
        </div>
        <div class="form-group row">
            <div class="form-group col-md-4">
                @{
                    if (Model.DocLever == 0)
                    {
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="0" checked>
                            <label class="form-check-label" for="inlineRadio1">Văn bản thường</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="1">
                            <label class="form-check-label" for="inlineRadio2">Văn bản khẩn</label>
                        </div>
                    }
                    else
                    {
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="0">
                            <label class="form-check-label" for="inlineRadio1">Văn bản thường</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="1" checked>
                            <label class="form-check-label" for="inlineRadio2">Văn bản khẩn</label>
                        </div>
                    }
                }

            </div>
            <div class="form-group col-md-4">
                @{
                    if (Model.DocStyleId == 2)
                    {
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="2" id="DocPlace2" checked onclick="openDocPlace()">
                            <label class="form-check-label" for="inlineRadio1">Gửi nội bộ</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="1" id="DocPlace1" onclick="openDocPlace()">
                            <label class="form-check-label" for="inlineRadio2">Gửi ra ngoài</label>
                        </div>
                    }
                    else if (Model.DocStyleId == 1)
                    {
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="2" id="DocPlace2" onclick="openDocPlace()">
                            <label class="form-check-label" for="inlineRadio1">Gửi nội bộ</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="1" id="DocPlace1" checked onclick="openDocPlace()">
                            <label class="form-check-label" for="inlineRadio2">Gửi ra ngoài</label>
                        </div>
                    }
                }

            </div>
            <label class="col-form-label col-md-1 col-sm-1">Ngày phát hành</label>
            <div class="col-md-3 col-sm-3">
                @(Html.DevExtreme().DateBoxFor(m => m.DocDate))
            </div>
        </div>
        <div class="form-group row">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-1 col-sm-1">Hình thức</label>
                <div class="col-md-3 col-sm-3">
                    @(Html.DevExtreme().SelectBoxFor(m => m.DocTypeId).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .Controller("lookup")
                                                                                                .LoadAction("getDoctype")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("DocTypeId"))
                                                                                            .DisplayExpr("TypeName")
                                                                                            .ValueExpr("DocTypeId")
                                                                                            .SearchEnabled(true))
                </div>
                <label class="col-form-label col-md-1 col-sm-1">Số tờ</label>
                <div class="col-md-1 col-sm-1">
                    @Html.DevExtreme().TextBoxFor(m => m.NumberOfPage)
                </div>
                <label class="col-form-label col-md-1 col-sm-1">Người kí</label>
                <div class="col-md-5 col-sm-5">
                    @(Html.DevExtreme().SelectBoxFor(m => m.Singer).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .Controller("lookup")
                                                                                                .LoadAction("getSigner")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("UserName1"))
                                                                                            .DisplayExpr("FullName1")
                                                                                            .ValueExpr("FullName1")
                                                                                            .SearchEnabled(true))
                </div>
            </div>
        </div>
        <div class="form-group row">
            @{
                if (Model.DocStyleId == 1)
                {
                    <div class="form-group col-md-12" id="DocPlace" style="display:block">
                        <label class="col-form-label col-md-1 col-sm-1">Nơi gửi</label>
                        <div class="col-md-11 col-sm-11">
                            @(Html.DevExtreme().SelectBoxFor(m => m.DocPlaceId).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .LoadAction("getDocplace")
                                                                                                .Controller("lookup")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("DocPlaceId"))
                                                                                            .DisplayExpr("DocPlaceName")
                                                                                            .ValueExpr("DocPlaceId")
                                                                                            .SearchEnabled(true))
                        </div>
                    </div>
                }
                else
                {
                    <div class="form-group col-md-12" id="DocPlace" style="display:none">
                        <label class="col-form-label col-md-1 col-sm-1">Nơi gửi</label>
                        <div class="col-md-11 col-sm-11">
                            @(Html.DevExtreme().SelectBoxFor(m => m.DocPlaceId).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .LoadAction("getDocplace")
                                                                                                .Controller("lookup")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("DocPlaceId"))
                                                                                            .DisplayExpr("DocPlaceName")
                                                                                            .ValueExpr("DocPlaceId")
                                                                                            .SearchEnabled(true))
                        </div>
                    </div>
                }
            }

        </div>
        <div class="form-group row">
            <div class="form-group col-md-12">
                <div class="col-md-1 col-sm-1">
                    <label class="custom-file-upload">
                        <input type="file" id="fileUpload" onchange="uploadMultipleFile(event)" name="files" multiple hidden />
                        <i class="fa fa-cloud-upload"></i>
                    </label>
                </div>
                <div class="col-md-1 col-sm-1">
                    @*@Html.DevExtreme().Button().Icon("fa fa-print")*@
                </div>
                <div class="col-md-10 col-sm-10">
                    <table class="table" id="ListofFiles">
                        <tr>
                            <th>
                                Files
                            </th>
                            <th>
                                Action
                            </th>
                        </tr>
                        @{
                            foreach (var item in ViewBag.listImage)
                            {
                                <tr>
                                    <td>
                                        <a data-toggle="modal" data-target="#exampleModal" data-imageid="@item.FileAttach">
                                            @item.FileAttach
                                        </a>
                                    </td>
                                    <td>
                                        <a href='#' onclick='DeleteFile(this,"@item.FileAttach")'><span class='glyphicon glyphicon-remove red'></span></a>
                                    </td>
                                </tr>
                            }
                        }
                    </table>
                </div>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:0px">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-12 col-sm-12">Tên và loại trích yếu văn bản</label>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-12 col-sm-12">
                @(Html.DevExtreme().TextAreaFor(m => m.Contents))
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:0px">
            <div class="form-group col-md-12">
                <label class="col-form-label col-md-12 col-sm-12">Ghi chú</label>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-12 col-sm-12">
                @(Html.DevExtreme().TextBoxFor(m => m.Note))
            </div>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-body">
                        <img id="myImg" style="width:100%;height:100%">
                        <input type="hidden" name="bookId" id="bookId" value="" />
                        <input type="text" class="form-control" id="recipient-name">
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="Close_modalImage()">Close</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
</form>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">
    function Close_modalImage() {
        $("#exampleModal").modal("hide");
    }
    function openDocPlace() {
        if (document.getElementById('DocPlace1').checked) {
            document.getElementById('DocPlace').style.display = 'block';
        } else {
            document.getElementById('DocPlace').style.display = 'none';
        }
    }

    /* event submit form upload*/
    function uploadMultipleFile(e) {
        var files = e.target.files;
        var formData = new FormData();
        for (var i = 0; i < files.length; i++) {
            formData.append("files", files[i]);
            var extensionFile = files[i].name;
            var markup = "<tr><td><a data-toggle='modal' data-target='#exampleModal' data-imageid=" + extensionFile + ">" + extensionFile + "</a></td><td><a href='#' onclick='DeleteFile(this,\"" + extensionFile + "\")'><span class='glyphicon glyphicon-remove red'></span></a></td></tr>";
            $("#ListofFiles tbody").append(markup);
        }
        axios.post("/DocGo/upLoadFiles", formData);
    }

    $('#exampleModal').on('show.bs.modal', function (event) {
        let bookId = $(event.relatedTarget).data('imageid');
        $(this).find('.modal-body input').val(bookId);
        document.getElementById('myImg').src = "/FileUploads/Document/" + bookId;
    })

    function DeleteFile(r, extensionFile) {
        var result = confirm("Are you sure you want to delete this file ?");
        if (result) {
            var i = r.parentNode.parentNode.rowIndex;
            document.getElementById('ListofFiles').deleteRow(i);
            $.post("/DocGo/DeleteFileEdit", $.param({ extensionFile: extensionFile }, true));
        }
    }
</script>

