
@{
    ViewData["Title"] = "AddDocGo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model Data.Models.Trading_system.Document
<style>
    .custom-file-upload {
        border: 1px solid #161515;
        display: inline-block;
        padding: 6px 12px;
        cursor: pointer;
        color: black;
    }
</style>
<div class="right_col" role="main" style="height:800px">
    <div class="">
        <div class="col-md-12 col-sm-12">
            <form method="post" asp-action="add_docgo" asp-controller="DocGo" enctype="multipart/form-data">

                <div class="x_panel">
                    <div class="x_title">
                        <h2>Thêm<small>văn bản đến</small></h2>
                        <ul class="nav navbar-right panel_toolbox">
                            <li>
                                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <a class="dropdown-item" href="#">Settings 1</a>
                                    <a class="dropdown-item" href="#">Settings 2</a>
                                </div>
                            </li>
                            <li>
                                <a class="close-link"><i class="fa fa-close"></i></a>
                            </li>
                        </ul>
                        @{
                            if (TempData["alertMessage"] != null)
                            {
                                <div style="color:red;font-size:30px">
                                    @TempData["alertMessage"].ToString()
                                </div>
                            }
                        }
                        @{
                            if (TempData["alertMessage1"] != null)
                            {
                                <div style="color:red;font-size:30px">
                                    @TempData["alertMessage1"].ToString()
                                </div>
                            }
                        }
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <br />
                        @using (Html.DevExtreme().ValidationGroup())
                        {
                            <div class="form-group row">
                                <div class="form-group col-md-4">
                                    <label class="col-form-label col-md-4 col-sm-4">Độ khẩn</label>
                                </div>
                                <div class="form-group col-md-4">
                                    <label class="col-form-label col-md-4 col-sm-4">Loại văn bản</label>
                                </div>
                                <label class="col-form-label col-md-1 col-sm-1">Số/Ký hiệu</label>
                                <div class="col-md-3 col-sm-3">
                                    @(Html.DevExtreme().TextBoxFor(m => m.NumberSign))
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="form-group col-md-4">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="0" checked>
                                        <label class="form-check-label" for="inlineRadio1">Văn bản thường</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocLever)" value="1">
                                        <label class="form-check-label" for="inlineRadio2">Văn bản khẩn</label>
                                    </div>
                                </div>
                                <div class="form-group col-md-4">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="2" checked>
                                        <label class="form-check-label" for="inlineRadio1">Gửi nội bộ</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="@Html.NameFor(m => m.DocStyleId)" value="1">
                                        <label class="form-check-label" for="inlineRadio2">Gửi ra ngoài</label>
                                    </div>
                                </div>
                                <label class="col-form-label col-md-1 col-sm-1">Ngày phát hành</label>
                                <div class="col-md-3 col-sm-3">
                                    @(Html.DevExtreme().DateBoxFor(m => m.DocDate))
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="form-group col-md-12">
                                    <label class="col-form-label col-md-1 col-sm-1">Hình thức</label>
                                    <div class="col-md-3 col-sm-3">
                                        @(Html.DevExtreme().SelectBoxFor(m => m.DocTypeId).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .Controller("lookup")
                                                                                                .LoadAction("getDoctype")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("DocTypeId"))
                                                                                            .DisplayExpr("TypeName")
                                                                                            .ValueExpr("DocTypeId")
                                                                                            .SearchEnabled(true))
                                    </div>
                                    <label class="col-form-label col-md-1 col-sm-1">Số tờ</label>
                                    <div class="col-md-1 col-sm-1">
                                        @Html.DevExtreme().TextBoxFor(m => m.NumberOfPage)
                                    </div>
                                    <label class="col-form-label col-md-1 col-sm-1">Người kí</label>
                                    <div class="col-md-5 col-sm-5">
                                        @(Html.DevExtreme().SelectBoxFor(m => m.Singer).DataSource(d => d
                                                                                                .Mvc()
                                                                                                .Controller("lookup")
                                                                                                .LoadAction("getSigner")
                                                                                                .LoadMode(DataSourceLoadMode.Raw)
                                                                                                .Key("UserName1"))
                                                                                            .DisplayExpr("FullName1")
                                                                                            .ValueExpr("FullName1")
                                                                                            .SearchEnabled(true))
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="form-group col-md-12">
                                    <div class="col-md-1 col-sm-1">
                                        <label class="custom-file-upload">
                                            <input type="file" id="fileUpload" onchange="uploadMultipleFile(event)" name="files" multiple hidden />
                                            <i class="fa fa-cloud-upload"></i>
                                        </label>
                                    </div>
                                    <div class="col-md-1 col-sm-1">
                                        @*@Html.DevExtreme().Button().Icon("fa fa-print")*@
                                    </div>
                                    <div class="col-md-10 col-sm-10">
                                        <table class="table" id="ListofFiles">
                                            <tr>
                                                <th>
                                                    Files
                                                </th>
                                                <th>
                                                    Action
                                                </th>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row" style="margin-bottom:0px">
                                <div class="form-group col-md-12">
                                    <label class="col-form-label col-md-12 col-sm-12">Tên và loại trích yếu văn bản</label>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-12 col-sm-12">
                                    @(Html.DevExtreme().TextAreaFor(m => m.Contents))
                                </div>
                            </div>
                            <div class="form-group row" style="margin-bottom:0px">
                                <div class="form-group col-md-12">
                                    <label class="col-form-label col-md-12 col-sm-12">Ghi chú</label>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-md-12 col-sm-12">
                                    @(Html.DevExtreme().TextBoxFor(m => m.Note))
                                </div>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group row">
                                <div class="col-md-9 col-sm-9  offset-md-5">
                                    @(Html.DevExtreme().Button()
                                        .ID("button")
                                        .Text("Submit")
                                        .Type(ButtonType.Success)
                                        .UseSubmitBehavior(true)
                                    )
                                </div>
                            </div>


                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">

                                        <div class="modal-body">
                                            <img id="myImg" style="width:100%;height:100%">
                                            <input type="hidden" name="bookId" id="bookId" value="" />
                                            <input type="text" class="form-control" id="recipient-name">
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        </div>

                                    </div>
                                </div>
                            </div>

                        }

                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">
    /* event submit form upload*/
    function uploadMultipleFile(e) {

        var files = e.target.files;
        var formData = new FormData();
        for (var i = 0; i < files.length; i++) {
            formData.append("files", files[i]);
            var extensionFile = files[i].name;
            var markup = "<tr><td><a data-toggle='modal' data-target='#exampleModal' data-imageid=" + extensionFile + ">" + extensionFile + "</a></td><td><a href='#' onclick='DeleteFile(this,\"" + extensionFile + "\")'><span class='glyphicon glyphicon-remove red'></span></a></td></tr>";
            $("#ListofFiles tbody").append(markup);
        }
        axios.post("/DocGo/upLoadFiles", formData);
    }

    $('#exampleModal').on('show.bs.modal', function (event) {
        let bookId = $(event.relatedTarget).data('imageid');
        $(this).find('.modal-body input').val(bookId);
        document.getElementById('myImg').src = "/FileUploads/DocGo/" + bookId;
    })

    function DeleteFile(r, extensionFile) {
        var i = r.parentNode.parentNode.rowIndex;
        document.getElementById('ListofFiles').deleteRow(i);
        try {
            $.post("/DocCome/DeleteFile", $.param({ extensionFile: extensionFile }, true));
        }
        catch {
            $.notify("something wrong", "error");
        }
    }
</script>



